<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Products ‚Äî SnackShop</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <!-- Top Notification Bar -->
  <div class="top-bar">
    üéâ Festive Sale: Get up to 25% Off on Selected Snacks! üçø
  </div>

  <!-- Navbar -->
  <header class="navbar">
    <div class="logo">Namkeen <span>Snacks</span></div>
    <nav>
      <ul>
        <li><a href="{{ url_for('index') }}">HOME</a></li>
        <li><a href="{{ url_for('order') }}">ORDER <span class="new">NEW</span></a></li>
        <li><a href="{{ url_for('products') }}">PRODUCTS <span class="tag">BESTPRODUCT</span></a></li>
        <li>
          <a href="{{ url_for('shopall') }}">SHOP ALL ‚ñº</a>
          <ul>
            <li><a href="{{ url_for('snacks') }}">Snacks</a></li>
            <li><a href="{{ url_for('chuda') }}">Chuda</a></li>
            <li><a href="{{ url_for('poha') }}">Poha</a></li>
            <li><a href="{{ url_for('namkeen') }}">Namkeen</a></li>
          </ul>
        </li>
        <li>
          <a href="{{ url_for('cart') }}">CART ‚ñº</a>
          <ul>
            <li><a href="{{ url_for('checkout') }}">Checkout</a></li>
            <li><a href="{{ url_for('wishlist') }}">Wishlist</a></li>
          </ul>
        </li>
        <li><a href="{{ url_for('about') }}">ABOUT US</a></li>
      </ul>
    </nav>

    <!-- Sidebar Profile -->
    <div id="profileSidebar" class="profile-sidebar">
      <span class="close-profile" onclick="toggleProfile()">‚úñ</span>
      <div class="profile-header" id="profileName">üë§ Guest</div>

      <div class="profile-menu">
        <button onclick="toggleSection('ordersSection')">üì¶ Your Orders</button>
        <button onclick="toggleSection('listSection')">üìù Your List (Cart)</button>
        <button onclick="toggleSection('buyagainSection')">üîÑ Buy Again</button>
      </div>

      <div class="profile-section" id="ordersSection" style="display:none;">
        <h3>Your Orders</h3>
        <div id="ordersList"></div>
      </div>

      <div class="profile-section" id="listSection" style="display:none;">
        <h3>Your Cart</h3>
        <div id="listItems"></div>
      </div>

      <div class="profile-section" id="buyagainSection" style="display:none;">
        <h3>Buy Again</h3>
        <div id="buyAgainItems"></div>
      </div>
    </div>

    <div class="icons">
      <a href="javascript:void(0)" onclick="toggleProfile()">üë§</a>
    </div>

    <div class="logout-section">
      <button class="logout-btn" onclick="logoutUser()">üö™ Logout</button>
    </div>
  </header>

  <!-- Product Grid -->
  <main class="container" style="padding:40px 20px;">
    <h1 style="text-align:center;margin-bottom:30px;">Our Special Snacks üç™</h1>

    <div class="product-grid">
      <div class="product-card">
        <img src="{{ url_for('static', filename='images/pinuts.png') }}" alt="Masala Peanuts">
        <h2>Masala Peanuts</h2>
        <p>Crunchy roasted peanuts with spice mix.</p>
        <span class="price">‚Çπ 120</span>
        <button class="btn" onclick='addToCart({id:1,name:"Masala Peanuts",price:120})'>Add to Cart</button>
      </div>

      <div class="product-card">
        <img src="{{ url_for('static', filename='images/poha.png') }}" alt="Poha Chivda">
        <h2>Poha Chivda</h2>
        <p>Light & crispy flattened rice with spices.</p>
        <span class="price">‚Çπ 95</span>
        <button class="btn" onclick='addToCart({id:2,name:"Poha Chivda",price:95})'>Add to Cart</button>
      </div>

      <div class="product-card">
        <img src="{{ url_for('static', filename='images/mix blend.png') }}" alt="Spicy Mixture">
        <h2>Spicy Mixture</h2>
        <p>A crunchy blend of sev, boondi, & peanuts.</p>
        <span class="price">‚Çπ 150</span>
        <button class="btn" onclick='addToCart({id:3,name:"Spicy Mixture",price:150})'>Add to Cart</button>
      </div>

      <div class="product-card">
        <img src="{{ url_for('static', filename='images/chalkali.png') }}" alt="Chakli">
        <h2>Chakli</h2>
        <p>Traditional spiral snack made of rice flour.</p>
        <span class="price">‚Çπ 110</span>
        <button class="btn" onclick='addToCart({id:4,name:"Chakli",price:110})'>Add to Cart</button>
      </div>

      <div class="product-card">
        <img src="{{ url_for('static', filename='images/khakara.png') }}" alt="Khakhra">
        <h2>Khakhra</h2>
        <p>Healthy Gujarati flatbread snack.</p>
        <span class="price">‚Çπ 80</span>
        <button class="btn" onclick='addToCart({id:5,name:"Khakhra",price:80})'>Add to Cart</button>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">¬© 2025 SnackShop | All Rights Reserved</div>
  </footer>

  <script>
    // ------------------- CART -------------------
    function addToCart(product) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      // Check if product already exists
      let existing = cart.find(item => item.id === product.id);
      if (existing) {
          existing.qty += 1;
      } else {
          product.qty = 1;
          cart.push(product);
      }

      localStorage.setItem("cart", JSON.stringify(cart));

      renderProfileData();
      alert(`${product.name} added to cart! üõí`);
    }

    // ------------------- PROFILE SIDEBAR -------------------
    function toggleProfile() {
      document.getElementById("profileSidebar").classList.toggle("active");
      renderProfileData();
    }

    function toggleSection(id) {
      document.querySelectorAll(".profile-section").forEach(sec => {
        sec.style.display = (sec.id === id) ? "block" : "none";
      });
    }

    function renderProfileData() {
      let userName = localStorage.getItem("username") || "Guest User";
      document.getElementById("profileName").innerText = "üë§ " + userName;

      let orders = JSON.parse(localStorage.getItem("orders")) || [];
      let cart = JSON.parse(localStorage.getItem("cart")) || [];
      let buyAgain = JSON.parse(localStorage.getItem("buyAgain")) || [];

      renderOrders(orders);
      renderList(cart);
      renderBuyAgain(buyAgain);
    }

    function renderOrders(orders) {
      let container = document.getElementById("ordersList");
      container.innerHTML = "";
      if (orders.length === 0) container.innerHTML = "<p>No orders found.</p>";
      else orders.forEach(o => {
        container.innerHTML += `<div class="order-card"><span>${o.name} - ‚Çπ${o.price} x ${o.qty}</span></div>`;
      });
    }

    function renderList(cart) {
      let container = document.getElementById("listItems");
      container.innerHTML = "";
      if (cart.length === 0) container.innerHTML = "<p>Your cart is empty.</p>";
      else cart.forEach(c => {
        container.innerHTML += `<div class="order-card"><span>${c.name} - ‚Çπ${c.price} x ${c.qty}</span></div>`;
      });
    }

    function renderBuyAgain(buyAgain) {
      let container = document.getElementById("buyAgainItems");
      container.innerHTML = "";
      if (buyAgain.length === 0) container.innerHTML = "<p>No previous products.</p>";
      else buyAgain.forEach(b => {
        container.innerHTML += `<div class="order-card"><span>${b.name} - ‚Çπ${b.price} x ${b.qty}</span></div>`;
      });
    }

    // ------------------- LOGOUT -------------------
    function logoutUser() {
      localStorage.removeItem("isLoggedIn");
      localStorage.removeItem("username");
      localStorage.removeItem("cart");
      localStorage.removeItem("orders");
      alert("You have been logged out!");
      window.location.href = "{{ url_for('login') }}";
    }

    // ------------------- INITIAL LOAD -------------------
    window.onload = function() {
      renderProfileData();
    };
  </script>
</body>
</html>
